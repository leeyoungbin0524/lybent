<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LYB Admin</title>
  <link rel="icon" type="image/png" href="/favicon.png?v=1">

  <link rel="stylesheet" as="style" crossorigin
    href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"/>

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#121420;
      --panel2:rgba(255,255,255,.03);
      --text:#f2f3f7;
      --muted:rgba(242,243,247,.65);
      --line:rgba(242,243,247,.12);
      --accent:#5cffb0;
      font-family: Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
    }
    body{ margin:0; background:var(--bg); color:var(--text); }
    a{ color:inherit; text-decoration:none; }
    button, input, select, textarea{ font-family:inherit; }

    .iconbtn{
      border:1px solid var(--line);
      background:transparent;
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
    }
    .btn{
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
    }
    .btn:hover{ border-color:rgba(255,255,255,.22); }
    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .shell{ display:flex; min-height:100vh; }

    /* Sidebar */
    .sidebar{
      width:280px;
      border-right:1px solid var(--line);
      background:rgba(255,255,255,.02);
      padding:16px;
      position:sticky;
      top:0;
      height:100vh;
      display:flex;
      flex-direction:column;
      box-sizing:border-box;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
      padding:10px; border-radius:16px;
      border:1px solid var(--line);
      background:var(--panel);
    }
    .avatar{
      width:40px; height:40px; border-radius:14px;
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .brandTitle{ font-weight:900; }
    .brandSub{ color:var(--muted); font-size:12px; margin-top:2px; }

    .nav{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:12px;
    }
    .navItem{
      display:flex; align-items:center; gap:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid transparent;
      background:transparent;
      color:var(--text);
      cursor:pointer;
      text-align:left;
      width:100%;
    }
    .navItem:hover{ background:rgba(255,255,255,.04); border-color:rgba(255,255,255,.08); }
    .navItem.active{ background:var(--panel); border-color:var(--line); }
    .ico{ width:22px; display:inline-flex; justify-content:center; }

    .sideFoot{
      margin-top:auto;
      display:flex;
      flex-direction:column;
      gap:10px;
      padding-top:14px;
    }
    .footNote{ color:var(--muted); font-size:12px; line-height:1.4; word-break:break-all; }

    /* Content */
    .content{ flex:1; }
    .topbar{
      position:sticky; top:0; z-index:60;
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background:rgba(11,12,16,.72);
      backdrop-filter: blur(10px);
    }
    .topbarLeft{ display:flex; align-items:center; gap:10px; }
    .main{ padding:18px; box-sizing:border-box; }
    .title{ margin:10px 0 8px; font-size:28px; font-weight:900; }
    .sub{ margin:0 0 12px; color:var(--muted); }

    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
      margin:12px 0 14px;
      align-items:center;
    }
    .input{
      padding:10px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
    }

    .list{ margin-top:14px; display:grid; gap:14px; }
    .card{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      padding:16px;
    }
    .cardTitle{ font-weight:900; font-size:16px; }
    .muted{ color:var(--muted); font-size:13px; line-height:1.6; }

    .danger{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #ff4d4d;
      background:transparent;
      color:#ff4d4d;
      cursor:pointer;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
      margin-top:14px;
    }
    @media(max-width:1000px){
      .cards{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media(max-width:640px){
      .cards{ grid-template-columns: 1fr; }
    }
    .statK{ color:var(--muted); font-size:12px; letter-spacing:.12em; text-transform:uppercase; }
    .statV{ font-size:28px; font-weight:900; margin-top:6px; }

    .tableWrap{
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      overflow:hidden;
    }
    table{ width:100%; border-collapse:collapse; }
    th, td{ padding:10px 12px; border-bottom:1px solid var(--line); text-align:left; font-size:13px; }
    th{ color:var(--muted); font-weight:800; background:rgba(255,255,255,.02); }
    tr:hover td{ background:rgba(255,255,255,.02); }

    /* Mobile sidebar drawer */
    #menuBtn{ display:none; }
    .overlay{ display:none; }
    @media(max-width:900px){
      #menuBtn{ display:inline-flex; }
      .sidebar{
        position:fixed; left:-320px; top:0;
        width:280px; height:100vh; z-index:80;
        transition:left .22s ease;
      }
      .sidebar.open{ left:0; }
      .overlay{
        display:block;
        position:fixed; inset:0;
        background:rgba(0,0,0,.55);
        z-index:70;
        opacity:0;
        pointer-events:none;
        transition:opacity .22s ease;
      }
      .overlay.show{ opacity:1; pointer-events:auto; }
      .shell{ display:block; }
      .content{ margin-left:0; }
    }
  </style>
</head>

<body>
  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" aria-label="admin navigation">
      <div class="brand">
        <div class="avatar" id="adminAvatar">L</div>
        <div>
          <div class="brandTitle" id="adminName">â€”</div>
          <div class="brandSub">LYBENTERTAINMENT</div>
        </div>
      </div>

      <nav class="nav" style="margin-top:12px;">
        <button class="navItem active" data-view="applicants" type="button">
          <span class="ico">ğŸ“„</span><span>ì§€ì›ì</span>
        </button>
        <button class="navItem" data-view="stats" type="button">
          <span class="ico">ğŸ“Š</span><span>í†µê³„</span>
        </button>
         <button class="navItem" data-view="artists" type="button">
          <span class="ico">ğŸ¤</span><span>ì•„í‹°ìŠ¤íŠ¸</span>
        </button>
        <button class="navItem" data-view="goods" type="button">
          <span class="ico">ğŸ›ï¸</span><span>êµ¿ì¦ˆ</span>
        </button>
        <button class="navItem" data-view="shipping" type="button">
          <span class="ico">ğŸšš</span><span>ì£¼ë¬¸/ë°°ì†¡</span>
        </button>
        <button class="navItem" data-view="settings" type="button">
          <span class="ico">âš™ï¸</span><span>ì„¤ì •</span>
        </button>
      </nav>

      <div class="sideFoot">
        <a class="btn" href="index.html" style="text-align:center;">ì‚¬ì´íŠ¸ë¡œ</a>
        <button class="btn" id="logoutBtn" type="button">ë¡œê·¸ì•„ì›ƒ</button>
        <div class="footNote" id="adminEmail">â€”</div>
      </div>
    </aside>

    <!-- Content -->
    <section class="content">
      <div class="topbar">
        <div class="topbarLeft">
          <button class="iconbtn" id="menuBtn" aria-label="menu">â˜°</button>
          <div class="pill" id="status">Loadingâ€¦</div>
          <div class="pill" id="authStatus">Auth: â€”</div>
        </div>
        <div style="display:flex;gap:10px;align-items:center;">
          <div class="pill" id="nowTime">â€”</div>
        </div>
      </div>

      <div class="main">
        <!-- Applicants -->
        <section class="view" id="view-applicants">
          <div class="title">ì§€ì›ì ê´€ë¦¬</div>
          <div class="sub">Audition í…Œì´ë¸” ë°ì´í„°ë¥¼ í™•ì¸/ì‚­ì œí•  ìˆ˜ ìˆì–´ìš”.</div>

          <div class="toolbar">
            <input id="searchInput" class="input" placeholder="ì´ë¦„ ê²€ìƒ‰" />
            <select id="filterPosition" class="input">
              <option value="">ì „ì²´ í¬ì§€ì…˜</option>
              <option value="ë³´ì»¬">ë³´ì»¬</option>
              <option value="ëŒ„ìŠ¤">ëŒ„ìŠ¤</option>
              <option value="ì—°ê¸°">ì—°ê¸°</option>
              <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
            <button id="refreshBtn" class="btn" type="button">ìƒˆë¡œê³ ì¹¨</button>
          </div>

          <div id="list" class="list"></div>
        </section>

        <!-- Stats -->
        <section class="view" id="view-stats" hidden>
          <div class="title">í†µê³„</div>
          <div class="sub">ì§€ì›ì í˜„í™©ì„ ìš”ì•½í•´ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>

          <div class="cards">
            <div class="card"><div class="statK">ì´ ì§€ì›ì</div><div class="statV" id="statTotal">â€”</div></div>
            <div class="card"><div class="statK">ë³´ì»¬</div><div class="statV" id="statVocal">â€”</div></div>
            <div class="card"><div class="statK">ëŒ„ìŠ¤</div><div class="statV" id="statDance">â€”</div></div>
            <div class="card"><div class="statK">ì—°ê¸°</div><div class="statV" id="statAct">â€”</div></div>
            <div class="card"><div class="statK">ê¸°íƒ€</div><div class="statV" id="statEtc">â€”</div></div>
          </div>
        </section>
        <section class="view" id="view-artists" hidden>
  <div class="title">ì•„í‹°ìŠ¤íŠ¸</div>
  <div class="sub">artists í…Œì´ë¸”ì„ ì¡°íšŒ/ë“±ë¡/ìˆ˜ì •í•©ë‹ˆë‹¤.</div>

  <div class="card" style="margin-top:12px;">
    <div style="font-weight:900;margin-bottom:10px;">ì•„í‹°ìŠ¤íŠ¸ ë“±ë¡ / ìˆ˜ì •</div>

    <form id="artistForm" style="display:grid;gap:10px;grid-template-columns:1fr 1fr;">
      <input id="artistName" class="input" placeholder="ì´ë¦„ (í•„ìˆ˜)" required style="grid-column:1 / -1;">
      <input id="artistRole" class="input" placeholder="í¬ì§€ì…˜/ì„¤ëª… (ì˜ˆ: Vocal, Actor)">
      <input id="artistSort" class="input" placeholder="ì •ë ¬(ìˆ«ì, ì‘ì„ìˆ˜ë¡ ìœ„)" type="number" value="0">

      <select id="artistActive" class="input">
        <option value="true">í™œì„±</option>
        <option value="false">ë¹„í™œì„±</option>
      </select>

      <input id="artistEditId" type="hidden" value="">

      <input id="artistImageUrl" class="input" placeholder="ì´ë¯¸ì§€ URL (ì„ íƒ)" style="grid-column:1 / -1;">
      <input id="artistImageFile" class="input" type="file" accept="image/*" style="grid-column:1 / -1;">

      <textarea id="artistBio" class="input" placeholder="ì†Œê°œ(ì„ íƒ)"
        style="grid-column:1 / -1; min-height:110px;"></textarea>

      <button id="artistSaveBtn" class="btn" type="submit" style="width:max-content;">ë“±ë¡ / ì €ì¥</button>
      <button id="artistCancelBtn" class="btn" type="button" style="width:max-content; display:none;">ìˆ˜ì • ì·¨ì†Œ</button>

      <div class="muted" style="grid-column:1 / -1;">
        â€» ë“±ë¡í•˜ë©´ artists.htmlì— ìë™ í‘œì‹œë©ë‹ˆë‹¤(í™œì„± ì•„í‹°ìŠ¤íŠ¸ ê¸°ì¤€).
      </div>
    </form>

    <div class="pill" id="artistMsg" style="margin-top:10px;display:none;"></div>
  </div>

  <div class="toolbar" style="margin-top:12px;">
    <input id="artistSearch" class="input" placeholder="ì´ë¦„ ê²€ìƒ‰" />
    <button id="artistRefreshBtn" class="btn" type="button">ìƒˆë¡œê³ ì¹¨</button>
  </div>

  <div class="tableWrap">
    <table>
      <thead>
        <tr>
          <th>ì´ë¦„</th><th>ì—­í• </th><th>ì •ë ¬</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th>
        </tr>
      </thead>
      <tbody id="artistTbody">
        <tr><td colspan="5" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>
      </tbody>
    </table>
  </div>

  <div class="pill" style="margin-top:12px;">â€» Storage ë²„í‚·: <b>artist-images</b> ìƒì„± í•„ìš”(íŒŒì¼ ì—…ë¡œë“œ ì“¸ ë•Œ)</div>
</section>

        <!-- Goods -->
        <section class="view" id="view-goods" hidden>
          <div class="title">êµ¿ì¦ˆ</div>
          <div class="sub">products í…Œì´ë¸”ì„ ì¡°íšŒ/ë“±ë¡/ìˆ˜ì •í•©ë‹ˆë‹¤.</div>

          <div class="card" style="margin-top:12px;">
            <div style="font-weight:900;margin-bottom:10px;">ìƒí’ˆ ë“±ë¡ / ìˆ˜ì •</div>

            <form id="goodsCreateForm" style="display:grid;gap:10px;grid-template-columns:1fr 1fr;">
              <input id="newGoodsName" class="input" placeholder="ìƒí’ˆëª… (í•„ìˆ˜)" required style="grid-column:1 / -1;">

              <input id="newGoodsPrice" class="input" placeholder="ê°€ê²© (ìˆ«ì)" type="number" min="0">
              <input id="newGoodsStock" class="input" placeholder="ì¬ê³  (ìˆ«ì)" type="number" min="0">

              <select id="newGoodsActive" class="input">
                <option value="true">í™œì„±</option>
                <option value="false">ë¹„í™œì„±</option>
              </select>

              <input id="editGoodsId" type="hidden" value="">

              <input id="newGoodsImage" class="input" placeholder="ì´ë¯¸ì§€ URL (ì„ íƒ)" style="grid-column:1 / -1;">
              <input id="newGoodsImageFile" class="input" type="file" accept="image/*" style="grid-column:1 / -1;">

              <textarea id="newGoodsDesc" class="input" placeholder="ìƒí’ˆ ì„¤ëª… (ì„ íƒ)"
                style="grid-column:1 / -1; min-height:110px;"></textarea>

              <button id="goodsCreateBtn" class="btn" type="submit" style="width:max-content;">ë“±ë¡ / ì €ì¥</button>
              <button id="goodsCancelBtn" class="btn" type="button" style="width:max-content; display:none;">ìˆ˜ì • ì·¨ì†Œ</button>

              <div class="muted" style="grid-column:1 / -1;">
                â€» ë“±ë¡í•˜ë©´ goods.htmlì— ìë™ í‘œì‹œë©ë‹ˆë‹¤(í™œì„± ìƒí’ˆ ê¸°ì¤€).
              </div>
            </form>

            <div class="pill" id="goodsCreateMsg" style="margin-top:10px;display:none;"></div>
          </div>

          <div class="toolbar" style="margin-top:12px;">
            <input id="goodsSearch" class="input" placeholder="ìƒí’ˆëª… ê²€ìƒ‰" />
            <button id="goodsRefreshBtn" class="btn" type="button">ìƒˆë¡œê³ ì¹¨</button>
          </div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr>
                  <th>ìƒí’ˆëª…</th><th>ê°€ê²©</th><th>ì¬ê³ </th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th>
                </tr>
              </thead>
              <tbody id="goodsTbody">
                <tr><td colspan="5" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>
              </tbody>
            </table>
          </div>

          <div class="pill" style="margin-top:12px;">
            â€» Storage ë²„í‚·: <b>product-images</b> ìƒì„± í•„ìš”
          </div>
        </section>

        <!-- Shipping -->
        <section class="view" id="view-shipping" hidden>
          <div class="title">ì£¼ë¬¸/ë°°ì†¡</div>
          <div class="sub">orders í…Œì´ë¸”ì„ ì¡°íšŒí•©ë‹ˆë‹¤.</div>

          <div class="toolbar">
            <select id="orderStatus" class="input">
              <option value="">ì „ì²´ ìƒíƒœ</option>
              <option value="pending">pending</option>
              <option value="paid">paid</option>
              <option value="shipping">shipping</option>
              <option value="done">done</option>
            </select>
            <button id="ordersRefreshBtn" class="btn" type="button">ìƒˆë¡œê³ ì¹¨</button>
          </div>

          <div class="tableWrap">
            <table>
              <thead>
                <tr><th>ë‚ ì§œ</th><th>ì£¼ë¬¸ì</th><th>ìƒí’ˆ</th><th>ì „í™”ë²ˆí˜¸</th><th>ìˆ˜ëŸ‰</th><th>ìƒíƒœ</th><th>ìš°í¸ë²ˆí˜¸</th><th>ì£¼ì†Œ</th><th>ìƒì„¸ì£¼ì†Œ</th><th>ê´€ë¦¬</th></tr>
              </thead>
              <tbody id="ordersTbody">
                <tr><td colspan="6" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>
              </tbody>
            </table>
          </div>

          <div class="pill" style="margin-top:12px;">â€» orders í…Œì´ë¸”ì´ ì—†ìœ¼ë©´ Supabaseì—ì„œ ìƒì„± í•„ìš”</div>
        </section>

        <!-- Settings -->
        <section class="view" id="view-settings" hidden>
          <div class="title">ì„¤ì •</div>
          <div class="sub">ê´€ë¦¬ì ë„êµ¬ë¥¼ í™•ì¥í•  ìˆ˜ ìˆì–´ìš”.</div>

          <div class="card">
            <div style="font-weight:900;margin-bottom:8px;">ë¹ ë¥¸ ì‘ì—…</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
              <button class="btn" id="exportCsvBtn" type="button">CSV ë‚´ë³´ë‚´ê¸°</button>
              <button class="btn" id="clearFiltersBtn" type="button">í•„í„° ì´ˆê¸°í™”</button>
            </div>
            <div class="muted" style="margin-top:10px;">
              * CSVëŠ” ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.
            </div>
          </div>
        </section>
      </div>
    </section>
  </div>

  <!-- âœ… ë¡œë“œ ìˆœì„œ -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="supabase-client.js"></script>
  <script src="auth-status.js"></script>

  <script>
    const sb = window.supabaseClient;

    // ì‹œê°„í‘œì‹œ
    function tick(){
      const el = document.getElementById("nowTime");
      if(!el) return;
      el.textContent = new Date().toLocaleString();
    }
    setInterval(tick, 1000);
    tick();

    function setStatus(t){
      const el = document.getElementById("status");
      if(el) el.textContent = t || "";
    }

    function escapeHtml(s=""){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[m]));
    }
    function nameFromEmail(email){
      if(!email) return "Admin";
      return (email.split("@")[0] || "Admin");
    }

    // ëª¨ë°”ì¼ ì‚¬ì´ë“œë°”
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    function openSidebar(){
      sidebar.classList.add("open");
      overlay.classList.add("show");
      overlay.setAttribute("aria-hidden","false");
    }
    function closeSidebar(){
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
      overlay.setAttribute("aria-hidden","true");
    }

    let auditionData = [];
    let goodsData = [];
    let ordersData = [];

    async function requireLogin(){
      const { data: { user }, error } = await sb.auth.getUser();
      if (error || !user) {
        location.href = "login.html";
        return null;
      }
      return user;
    }

    async function isAdmin(){
      const { data: { user }, error: userErr } = await sb.auth.getUser();
      if (userErr || !user) return false;

      const { data, error } = await sb
        .from("admins")
        .select("user_id")
        .eq("user_id", user.id)
        .maybeSingle();

      return !error && !!data;
    }

    function switchView(view){
      const views = ["applicants","stats","artists","goods","shipping","settings"];
      for (const v of views) {
        const el = document.getElementById("view-" + v);
        if (el) el.hidden = (v !== view);
      }
      document.querySelectorAll(".navItem").forEach(btn=>{
        btn.classList.toggle("active", btn.dataset.view === view);
      });
      closeSidebar();

      if(view === "artists") loadArtists();
      if(view === "goods") loadGoods();     // ë“¤ì–´ê°ˆ ë•Œë§ˆë‹¤ ìµœì‹ í™”
      if(view === "shipping") loadOrders(); // âœ… í•­ìƒ ë¡œë“œ
    }

    // ---------- Applicants ----------
    function renderStats(data){
      document.getElementById("statTotal").textContent = String((data||[]).length);
      document.getElementById("statVocal").textContent = String((data||[]).filter(x => x.position === "ë³´ì»¬").length);
      document.getElementById("statDance").textContent = String((data||[]).filter(x => x.position === "ëŒ„ìŠ¤").length);
      document.getElementById("statAct").textContent = String((data||[]).filter(x => x.position === "ì—°ê¸°").length);
      document.getElementById("statEtc").textContent = String((data||[]).filter(x => x.position === "ê¸°íƒ€").length);
    }

    function renderList(data){
      const list = document.getElementById("list");
      if(!list) return;

      const keyword = (document.getElementById("searchInput").value || "").toLowerCase();
      const filter = document.getElementById("filterPosition").value;

      const filtered = (data || []).filter(r=>{
        const matchName = (r.name || "").toLowerCase().includes(keyword);
        const matchPos = filter ? r.position === filter : true;
        return matchName && matchPos;
      });

      if(!filtered.length){
        list.innerHTML = `<div class="card">ì§€ì›ìê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      } else {
        list.innerHTML = filtered.map(r=>`
          <div class="card">
            <div class="cardTitle">${escapeHtml(r.name || "â€”")} Â· ${escapeHtml(r.position || "")}</div>
            <div class="muted">${escapeHtml(r.phone || "")}</div>
            <div class="muted">${escapeHtml(r.video_link || "")}</div>
            <div class="muted" style="margin-top:8px;">${escapeHtml(r.message || "")}</div>
            <div style="margin-top:12px;display:flex;gap:8px;">
              <button type="button" class="danger" onclick="deleteApplicant('${r.id}')">ì‚­ì œ</button>
            </div>
          </div>
        `).join("");
      }

      renderStats(data);
    }

    async function loadApplicants(){
      setStatus("ì§€ì›ì ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦");
      const { data, error } = await sb
        .from("Audition")
        .select("*")
        .order("created_at", { ascending:false });

      if(error){
        setStatus("ì§€ì›ì ì¡°íšŒ ì‹¤íŒ¨: " + error.message);
        return;
      }
      auditionData = data || [];
      setStatus(`ì§€ì›ì ${auditionData.length}ëª…`);
      renderList(auditionData);
    }

    async function deleteApplicant(id){
      if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      const { error } = await sb.from("Audition").delete().eq("id", id);
      if(error){ alert("ì‚­ì œ ì‹¤íŒ¨: " + error.message); return; }
      await loadApplicants();
    }
    window.deleteApplicant = deleteApplicant;

    // ---------- Artists (CRUD + Image Upload + Edit) ----------
let artistsData = [];

const ARTIST_IMAGE_BUCKET = "artist-images";

const artistForm = document.getElementById("artistForm");
const artistMsg = document.getElementById("artistMsg");
const artistEditIdEl = document.getElementById("artistEditId");
const artistCancelBtn = document.getElementById("artistCancelBtn");

function setArtistMsg(t){
  if(!artistMsg) return;
  artistMsg.textContent = t || "";
  artistMsg.style.display = t ? "inline-flex" : "none";
}

function clearArtistForm(){
  ["artistName","artistRole","artistSort","artistBio","artistImageUrl"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value = (id === "artistSort") ? "0" : "";
  });
  const act = document.getElementById("artistActive");
  if(act) act.value = "true";
  const fileEl = document.getElementById("artistImageFile");
  if(fileEl) fileEl.value = "";
  if(artistEditIdEl) artistEditIdEl.value = "";
  if(artistCancelBtn) artistCancelBtn.style.display = "none";
  const btn = document.getElementById("artistSaveBtn");
  if(btn) btn.textContent = "ë“±ë¡ / ì €ì¥";
}

function enterArtistEditMode(a){
  document.getElementById("artistName").value = a.name || "";
  document.getElementById("artistRole").value = a.role || "";
  document.getElementById("artistSort").value = (a.sort_order ?? 0);
  document.getElementById("artistActive").value = (a.is_active === false) ? "false" : "true";
  document.getElementById("artistImageUrl").value = a.image_url || "";
  document.getElementById("artistBio").value = a.bio || "";
  if(artistEditIdEl) artistEditIdEl.value = a.id;
  if(artistCancelBtn) artistCancelBtn.style.display = "inline-flex";
  const btn = document.getElementById("artistSaveBtn");
  if(btn) btn.textContent = "ìˆ˜ì • ì €ì¥";
  setArtistMsg("ìˆ˜ì • ëª¨ë“œ: ê°’ ë°”ê¾¸ê³  'ìˆ˜ì • ì €ì¥' ëˆ„ë¥´ê¸°");
}

window.editArtist = function(id){
  const a = (artistsData || []).find(x => x.id === id);
  if(!a) return;
  enterArtistEditMode(a);
  artistForm?.scrollIntoView({ behavior:"smooth", block:"start" });
};

function renderArtists(rows){
  const q = (document.getElementById("artistSearch")?.value || "").toLowerCase();
  const tbody = document.getElementById("artistTbody");
  if(!tbody) return;

  const filtered = (rows || []).filter(r => (r.name || "").toLowerCase().includes(q));

  if(!filtered.length){
    tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">ì•„í‹°ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  tbody.innerHTML = filtered.map(a=>{
    const active = (a.is_active === false) ? "ë¹„í™œì„±" : "í™œì„±";
    const thumb = a.image_url
      ? `<img src="${escapeHtml(a.image_url)}" alt="img"
            style="width:42px;height:42px;object-fit:cover;border-radius:10px;border:1px solid var(--line);" />`
      : "";
    const imgLink = a.image_url
      ? `<a class="pill" href="${escapeHtml(a.image_url)}" target="_blank" rel="noreferrer" style="padding:4px 8px;">ì´ë¯¸ì§€</a>`
      : "";

    return `<tr>
      <td>${escapeHtml(a.name || "")}</td>
      <td>${escapeHtml(a.role || "")}</td>
      <td>${escapeHtml(a.sort_order ?? 0)}</td>
      <td>${escapeHtml(active)}</td>
      <td style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        ${thumb}
        ${imgLink}
        <button type="button" class="btn" onclick="editArtist('${a.id}')">ìˆ˜ì •</button>
        <button type="button" class="danger" onclick="deleteArtist('${a.id}')">ì‚­ì œ</button>
      </td>
    </tr>`;
  }).join("");
}

async function loadArtists(){
  const tbody = document.getElementById("artistTbody");
  if(tbody) tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;

  const { data, error } = await sb
    .from("artists")
    .select("id, created_at, name, role, bio, image_url, is_active, sort_order")
    .order("sort_order", { ascending:true })
    .order("created_at", { ascending:false });

  if(error){
    if(tbody) tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">artists ì¡°íšŒ ì‹¤íŒ¨: ${escapeHtml(error.message)}</td></tr>`;
    artistsData = [];
    return;
  }

  artistsData = data || [];
  renderArtists(artistsData);
}

async function saveArtist(e){
  e?.preventDefault();
  setArtistMsg("ì €ì¥ ì¤‘â€¦");
  setStatus("ì•„í‹°ìŠ¤íŠ¸ ì €ì¥ ì¤‘â€¦");

  const { data:{ session }, error:sessErr } = await sb.auth.getSession();
  if(sessErr || !session?.user){
    setArtistMsg("âŒ ë¡œê·¸ì¸ í•„ìš”/ì„¸ì…˜ ì˜¤ë¥˜");
    setStatus("âŒ ì„¸ì…˜ ì˜¤ë¥˜");
    return;
  }

  const name = (document.getElementById("artistName")?.value || "").trim();
  const role = (document.getElementById("artistRole")?.value || "").trim();
  const sort_order = Number(document.getElementById("artistSort")?.value || 0) || 0;
  const bio = (document.getElementById("artistBio")?.value || "").trim();
  const is_active = (document.getElementById("artistActive")?.value === "true");

  const imageUrlInput = (document.getElementById("artistImageUrl")?.value || "").trim();
  const fileEl = document.getElementById("artistImageFile");
  const file = fileEl?.files?.[0] || null;

  if(!name){
    setArtistMsg("âŒ ì´ë¦„ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
    setStatus("âŒ ì´ë¦„ í•„ìš”");
    return;
  }

  let finalImageUrl = imageUrlInput;

  if(file){
    setArtistMsg("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘â€¦");

    const safeName = (name || "artist").toLowerCase().replace(/[^a-z0-9\-_.]/g, "-");
    const ext = (file.name.split(".").pop() || "png").toLowerCase();
    const path = `${Date.now()}_${safeName}.${ext}`;

    const { error: upErr } = await sb.storage
      .from(ARTIST_IMAGE_BUCKET)
      .upload(path, file, { upsert:true, cacheControl:"3600", contentType:file.type || undefined });

    if(upErr){
      setArtistMsg("âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: " + upErr.message);
      setStatus("âŒ ì—…ë¡œë“œ ì‹¤íŒ¨");
      return;
    }

    const { data: pub } = sb.storage.from(ARTIST_IMAGE_BUCKET).getPublicUrl(path);
    finalImageUrl = pub?.publicUrl || "";
  }

  const payload = { name, is_active, sort_order };
  if(role) payload.role = role;
  if(bio) payload.bio = bio;
  if(finalImageUrl) payload.image_url = finalImageUrl;

  const editingId = (artistEditIdEl?.value || "").trim();

  if(editingId){
    const { error } = await sb.from("artists").update(payload).eq("id", editingId);
    if(error){
      setArtistMsg("âŒ ìˆ˜ì • ì‹¤íŒ¨: " + error.message);
      setStatus("âŒ ìˆ˜ì • ì‹¤íŒ¨");
      return;
    }
    setArtistMsg("âœ… ìˆ˜ì • ì™„ë£Œ");
    setStatus("âœ… ìˆ˜ì • ì™„ë£Œ");
  } else {
    const { error } = await sb.from("artists").insert(payload);
    if(error){
      setArtistMsg("âŒ ë“±ë¡ ì‹¤íŒ¨: " + error.message);
      setStatus("âŒ ë“±ë¡ ì‹¤íŒ¨");
      return;
    }
    setArtistMsg("âœ… ë“±ë¡ ì™„ë£Œ");
    setStatus("âœ… ë“±ë¡ ì™„ë£Œ");
  }

  clearArtistForm();
  await loadArtists();
}

async function deleteArtist(id){
  if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  setArtistMsg("ì‚­ì œ ì¤‘â€¦");
  const { error } = await sb.from("artists").delete().eq("id", id);
  if(error){
    setArtistMsg("âŒ ì‚­ì œ ì‹¤íŒ¨: " + error.message);
    return;
  }
  setArtistMsg("âœ… ì‚­ì œ ì™„ë£Œ");
  await loadArtists();
}
window.deleteArtist = deleteArtist;

artistForm?.addEventListener("submit", saveArtist);
artistCancelBtn?.addEventListener("click", ()=>{ clearArtistForm(); setArtistMsg(""); });

    // ---------- Goods (CRUD + Image Upload + Edit) ----------
    const goodsForm = document.getElementById("goodsCreateForm");
    const goodsMsg = document.getElementById("goodsCreateMsg");
    const editGoodsIdEl = document.getElementById("editGoodsId");
    const cancelEditBtn = document.getElementById("goodsCancelBtn");

    // âœ… Supabase Storage ë²„í‚·ëª… (ëŒ€ì‹œë³´ë“œì—ì„œ ìƒì„± í•„ìš”)
    const PRODUCT_IMAGE_BUCKET = "product-images";

    function setGoodsMsg(t){
      if(!goodsMsg) return;
      goodsMsg.textContent = t || "";
      goodsMsg.style.display = t ? "inline-flex" : "none";
    }

    function numOrNull(v){
      const s = String(v ?? "").trim();
      if(!s) return null;
      const n = Number(s);
      return Number.isFinite(n) ? n : null;
    }
    function intOrNull(v){
      const n = numOrNull(v);
      return (n === null) ? null : Math.trunc(n);
    }

    function clearGoodsForm(){
      ["newGoodsName","newGoodsPrice","newGoodsStock","newGoodsImage","newGoodsDesc"].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.value = "";
      });
      const act = document.getElementById("newGoodsActive");
      if(act) act.value = "true";

      const fileEl = document.getElementById("newGoodsImageFile");
      if(fileEl) fileEl.value = "";

      if(editGoodsIdEl) editGoodsIdEl.value = "";
      if(cancelEditBtn) cancelEditBtn.style.display = "none";

      const btn = document.getElementById("goodsCreateBtn");
      if(btn) btn.textContent = "ë“±ë¡ / ì €ì¥";
    }

    function enterEditMode(p){
      if(!p) return;
      document.getElementById("newGoodsName").value = p.name || "";
      document.getElementById("newGoodsPrice").value = (p.price ?? "");
      document.getElementById("newGoodsStock").value = (p.stock ?? "");
      document.getElementById("newGoodsActive").value = (p.is_active === false) ? "false" : "true";
      document.getElementById("newGoodsImage").value = p.image_url || "";
      document.getElementById("newGoodsDesc").value = p.description || "";

      if(editGoodsIdEl) editGoodsIdEl.value = p.id;
      if(cancelEditBtn) cancelEditBtn.style.display = "inline-flex";

      const btn = document.getElementById("goodsCreateBtn");
      if(btn) btn.textContent = "ìˆ˜ì • ì €ì¥";

      setGoodsMsg("ìˆ˜ì • ëª¨ë“œ: ê°’ ë°”ê¾¸ê³  'ìˆ˜ì • ì €ì¥' ëˆ„ë¥´ê¸°");
    }

    window.editProduct = function(id){
      const p = (goodsData || []).find(x => x.id === id);
      enterEditMode(p);
      goodsForm?.scrollIntoView({ behavior:"smooth", block:"start" });
    };

    function renderGoods(rows){
      const q = (document.getElementById("goodsSearch").value || "").toLowerCase();
      const tbody = document.getElementById("goodsTbody");
      const filtered = (rows || []).filter(r => (r.name || "").toLowerCase().includes(q));

      if(!filtered.length){
        tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      tbody.innerHTML = filtered.map(p=>{
        const price = (p.price ?? "â€”");
        const stock = (p.stock ?? "â€”");
        const active = (p.is_active === false) ? "ë¹„í™œì„±" : "í™œì„±";

        const thumb = p.image_url
          ? `<img src="${escapeHtml(p.image_url)}" alt="img"
                style="width:42px;height:42px;object-fit:cover;border-radius:10px;border:1px solid var(--line);" />`
          : "";

        const imgLink = p.image_url
          ? `<a class="pill" href="${escapeHtml(p.image_url)}" target="_blank" rel="noreferrer"
                style="padding:4px 8px;">ì´ë¯¸ì§€</a>`
          : "";

        return `<tr>
          <td>${escapeHtml(p.name || "")}</td>
          <td>${escapeHtml(price)}</td>
          <td>${escapeHtml(stock)}</td>
          <td>${escapeHtml(active)}</td>
          <td style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            ${thumb}
            ${imgLink}
            <button type="button" class="btn" onclick="editProduct('${p.id}')">ìˆ˜ì •</button>
            <button type="button" class="danger" onclick="deleteProduct('${p.id}')">ì‚­ì œ</button>
          </td>
        </tr>`;
      }).join("");
    }

    async function loadGoods(){
      const tbody = document.getElementById("goodsTbody");
      tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;

      const { data, error } = await sb
        .from("products")
        .select("id, created_at, name, price, stock, is_active, image_url, description")
        .order("created_at", { ascending:false });

      if(error){
        tbody.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">products ì¡°íšŒ ì‹¤íŒ¨: ${escapeHtml(error.message)}</td></tr>`;
        goodsData = [];
        return;
      }

      goodsData = data || [];
      renderGoods(goodsData);
    }

    async function addProduct(e){
      e?.preventDefault();

      setGoodsMsg("ì €ì¥ ì¤‘â€¦");
      setStatus("ìƒí’ˆ ì €ì¥ ì¤‘â€¦");

      const { data:{ session }, error:sessErr } = await sb.auth.getSession();
      if(sessErr){
        setGoodsMsg("âŒ ì„¸ì…˜ ì˜¤ë¥˜: " + sessErr.message);
        setStatus("âŒ ì„¸ì…˜ ì˜¤ë¥˜");
        return;
      }
      if(!session?.user){
        setGoodsMsg("âŒ ë¡œê·¸ì¸ í•„ìš”");
        setStatus("âŒ ë¡œê·¸ì¸ í•„ìš”");
        return;
      }

      const name = (document.getElementById("newGoodsName")?.value || "").trim();
      const price = numOrNull(document.getElementById("newGoodsPrice")?.value);
      const stock = intOrNull(document.getElementById("newGoodsStock")?.value);
      const desc = (document.getElementById("newGoodsDesc")?.value || "").trim();
      const is_active = (document.getElementById("newGoodsActive")?.value === "true");

      const imageUrlInput = (document.getElementById("newGoodsImage")?.value || "").trim();
      const fileEl = document.getElementById("newGoodsImageFile");
      const file = fileEl?.files?.[0] || null;

      if(!name){
        setGoodsMsg("âŒ ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”.");
        setStatus("âŒ ìƒí’ˆëª… í•„ìš”");
        return;
      }

      let finalImageUrl = imageUrlInput;

      // íŒŒì¼ ì—…ë¡œë“œ ìˆìœ¼ë©´ storage ì—…ë¡œë“œ
      if(file){
        setGoodsMsg("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘â€¦");

        const safeName = (name || "product").toLowerCase().replace(/[^a-z0-9\-_.]/g, "-");
        const ext = (file.name.split(".").pop() || "png").toLowerCase();
        const path = `${Date.now()}_${safeName}.${ext}`;

        const { error: upErr } = await sb.storage
          .from(PRODUCT_IMAGE_BUCKET)
          .upload(path, file, { upsert:true, cacheControl:"3600", contentType:file.type || undefined });

        if(upErr){
          setGoodsMsg("âŒ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: " + upErr.message);
          setStatus("âŒ ì—…ë¡œë“œ ì‹¤íŒ¨");
          return;
        }

        const { data: pub } = sb.storage.from(PRODUCT_IMAGE_BUCKET).getPublicUrl(path);
        finalImageUrl = pub?.publicUrl || "";
      }

      const payload = { name, is_active };
      if(price !== null) payload.price = price;
      if(stock !== null) payload.stock = stock;
      if(desc) payload.description = desc;
      if(finalImageUrl) payload.image_url = finalImageUrl;

      const editingId = (editGoodsIdEl?.value || "").trim();

      if(editingId){
        setGoodsMsg("ìˆ˜ì • ì¤‘â€¦");
        const { error } = await sb.from("products").update(payload).eq("id", editingId);
        if(error){
          setGoodsMsg("âŒ ìˆ˜ì • ì‹¤íŒ¨: " + error.message);
          setStatus("âŒ ìˆ˜ì • ì‹¤íŒ¨");
          return;
        }
        setGoodsMsg("âœ… ìˆ˜ì • ì™„ë£Œ");
        setStatus("âœ… ìˆ˜ì • ì™„ë£Œ");
      } else {
        const { error } = await sb.from("products").insert(payload);
        if(error){
          setGoodsMsg("âŒ ë“±ë¡ ì‹¤íŒ¨: " + error.message);
          setStatus("âŒ ë“±ë¡ ì‹¤íŒ¨");
          return;
        }
        setGoodsMsg("âœ… ë“±ë¡ ì™„ë£Œ");
        setStatus("âœ… ë“±ë¡ ì™„ë£Œ");
      }

      clearGoodsForm();
      await loadGoods();
    }

    async function deleteProduct(id){
      if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      setGoodsMsg("ì‚­ì œ ì¤‘â€¦");

      const { error } = await sb.from("products").delete().eq("id", id);
      if(error){
        setGoodsMsg("âŒ ì‚­ì œ ì‹¤íŒ¨: " + error.message);
        return;
      }

      setGoodsMsg("âœ… ì‚­ì œ ì™„ë£Œ");
      await loadGoods();
    }
    window.deleteProduct = deleteProduct;

    goodsForm?.addEventListener("submit", addProduct);
    cancelEditBtn?.addEventListener("click", () => {
      clearGoodsForm();
      setGoodsMsg("");
    });

    // ---------- Orders ----------
    function renderOrders(rows){
  const statusFilter = document.getElementById("orderStatus")?.value || "";
  const tbody = document.getElementById("ordersTbody");

  const filtered = statusFilter
    ? (rows || []).filter(r => r.status === statusFilter)
    : (rows || []);

  if(!filtered.length){
    tbody.innerHTML = `<tr><td colspan="7" style="color:var(--muted);">ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }

  const options = (current) => ([
    ["pending","pending"],
    ["paid","paid"],
    ["shipping","shipping"],
    ["done","done"],
    ["cancelled","cancelled"]
  ].map(([v, label]) =>
    `<option value="${v}" ${String(current)===v ? "selected" : ""}>${label}</option>`
  ).join(""));
      
      tbody.innerHTML = filtered.map(o=>{
        const dt = o.created_at ? new Date(o.created_at).toLocaleString() : "â€”";
        const buyer = (o.buyer_email || o.buyer_name || o.user_id || "â€”");
        const item = (o.product_name || o.product_id || "â€”");
        const phone = (o.buyer_phone || "-");
        const qty = (o.qty ?? "â€”");
        const st = (o.status || "â€”");
        const addr = (o.shipping_postal || "â€”");
        const addr2 = (o.shipping_address1 || "â€”");
        const addr3 = (o.shipping_address2 || "â€”");
        return `<tr>
          <td>${escapeHtml(dt)}</td>
          <td>${escapeHtml(buyer)}</td>
          <td>${escapeHtml(item)}</td>
          <td>${escapeHtml(phone)}</td>
          <td>${escapeHtml(qty)}</td>
          <td>${escapeHtml(st)}</td>
          <td>${escapeHtml(addr || "â€”")}
          <td>${escapeHtml(addr2 || "â€”")}
          <td>${escapeHtml(addr3 || "â€”")}</td>
          <button class="btn" type="button" onclick="saveOrderStatus('${o.id}')">ì €ì¥</button>
      </td>
        </tr>`;
      }).join("");
    }

    // âœ… ë„ˆê°€ ë¹ ëœ¨ë ¸ë˜ í•µì‹¬: loadOrders ì •ì˜
    async function loadOrders(){
      const tbody = document.getElementById("ordersTbody");
      if(!tbody) return;

      tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted);">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr>`;

      const { data, error } = await sb
        .from("orders")
        .select("*")
        .order("created_at", { ascending:false });

      if(error){
        tbody.innerHTML = `<tr><td colspan="6" style="color:var(--muted);">orders ì¡°íšŒ ì‹¤íŒ¨: ${escapeHtml(error.message)}</td></tr>`;
        ordersData = [];
        return;
      }

      ordersData = data || [];
      renderOrders(ordersData);
    }
    

    // ---------- CSV / Logout ----------
    function exportCsv(){
      const rows = auditionData || [];
      const headers = ["created_at","name","phone","position","video_link","message","id"];
      const esc = (v) => {
        const s = (v ?? "").toString().replaceAll("\r\n", "\n").replaceAll("\r", "\n");
        const needs = /[\n\",]/.test(s);
        const out = s.replaceAll('"', '""');
        return needs ? `"${out}"` : out;
      };
      const csv = [headers.join(","), ...rows.map(r => headers.map(h => esc(r[h])).join(","))].join("\n");
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `auditions_${new Date().toISOString().slice(0,10)}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    async function logout(){
      setStatus("ë¡œê·¸ì•„ì›ƒ ì¤‘â€¦");
      try { await sb.auth.signOut(); } catch(e){}
      location.href = "login.html";
    }

    window.addEventListener("DOMContentLoaded", async () => {
      if(!sb){
        setStatus("âŒ supabaseClient ì—†ìŒ (supabase-client.js ë¡œë“œ/ìˆœì„œ í™•ì¸)");
        console.error("[admin] supabaseClient missing");
        return;
      }

      // ëª¨ë°”ì¼ ë©”ë‰´
      document.getElementById("menuBtn")?.addEventListener("click", openSidebar);
      overlay?.addEventListener("click", closeSidebar);

      // ë©”ë‰´ í´ë¦­
      document.querySelectorAll(".navItem").forEach(btn=>{
        btn.addEventListener("click", ()=> switchView(btn.dataset.view));
      });

      // íˆ´ë°” ì´ë²¤íŠ¸
      document.getElementById("searchInput")?.addEventListener("input", ()=> renderList(auditionData));
      document.getElementById("filterPosition")?.addEventListener("change", ()=> renderList(auditionData));
      document.getElementById("refreshBtn")?.addEventListener("click", loadApplicants);
      document.getElementById("logoutBtn")?.addEventListener("click", logout);

      document.getElementById("goodsSearch")?.addEventListener("input", ()=> renderGoods(goodsData));
      document.getElementById("goodsRefreshBtn")?.addEventListener("click", loadGoods);

      document.getElementById("artistSearch")?.addEventListener("input", ()=> renderArtists(artistsData));
      document.getElementById("artistRefreshBtn")?.addEventListener("click", loadArtists);

      document.getElementById("orderStatus")?.addEventListener("change", ()=> renderOrders(ordersData));
      document.getElementById("ordersRefreshBtn")?.addEventListener("click", loadOrders);

      document.getElementById("exportCsvBtn")?.addEventListener("click", exportCsv);
      document.getElementById("clearFiltersBtn")?.addEventListener("click", ()=>{
        const s = document.getElementById("searchInput"); if(s) s.value = "";
        const f = document.getElementById("filterPosition"); if(f) f.value = "";
        renderList(auditionData);
      });

      // ë¡œê·¸ì¸ í™•ì¸ + ì‚¬ì´ë“œë°” ì´ë¦„/ì´ë©”ì¼ í‘œì‹œ
      setStatus("ë¡œê·¸ì¸ í™•ì¸ ì¤‘â€¦");
      const user = await requireLogin();
      if(!user) return;

      const email = user.email || "";
      const displayName = (user.user_metadata?.display_name || "").trim();
      const label = displayName ? displayName : nameFromEmail(email);

      const nameEl = document.getElementById("adminName");
      const emailEl = document.getElementById("adminEmail");
      const avEl = document.getElementById("adminAvatar");
      if(nameEl) nameEl.textContent = label;
      if(emailEl) emailEl.textContent = email || "â€”";
      if(avEl) avEl.textContent = (label[0] || "A").toUpperCase();

      // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
      setStatus("ê´€ë¦¬ì ê¶Œí•œ í™•ì¸ ì¤‘â€¦");
      const ok = await isAdmin();
      if(!ok){
        setStatus("âŒ ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥ (admins í…Œì´ë¸” í™•ì¸)");
        return;
      }

      // ì´ˆê¸° ë¡œë“œ(ë“¤ì–´ì˜¤ìë§ˆì ë°”ë¡œ ë³´ì´ê²Œ)
      setStatus("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦");
      await loadApplicants();
      setStatus(`ì§€ì›ì ${auditionData.length}ëª…`);
      switchView("applicants");
    });
  </script>
</body>
</html>
